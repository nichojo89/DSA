package com.nichols.dsa.arrays

fun main(){
//    val A = arrayOf(
//        intArrayOf(1,2,3),
//        intArrayOf(4,5,6),
//        intArrayOf(7,8,9)
//    )
//
//    val B = intArrayOf(1,2)
//    val C = intArrayOf(1,2)
//    val D = intArrayOf(2,3)
//    val E = intArrayOf(2,3)
//    val ans = solveSubMatrix(A,B,C,D,E)
//    val A = arrayOf(
//        intArrayOf(45, 33, 29, 87, 45, 66, 32, 30, 75, 92, 56, 64, 94, 82, 11, 53, 74, 78, 100, 22, 2, 3, 85, 1, 23, 32, 2, 38, 47),
//        intArrayOf(17, 69, 76, 5, 48, 61, 70, 91, 96, 9, 34, 22, 74, 50, 54, 79, 24, 9, 60, 28, 32, 17, 88, 10, 48, 72, 15, 93, 8),
//        intArrayOf(40, 31, 6, 99, 44, 12, 51, 73, 40, 3, 58, 52, 81, 1, 2, 14, 85, 61, 5, 38, 75, 76, 61, 98, 33, 87, 89, 18, 12),
//        intArrayOf(28, 87, 2, 99, 22, 88, 85, 49, 100, 26, 73, 45, 18, 19, 53, 16, 36, 50, 5, 15, 4, 60, 51, 11, 19, 90, 50, 89, 83),
//        intArrayOf(42, 33, 22, 36, 71, 89, 10, 2, 4, 59, 89, 25, 17, 48, 5, 71, 4, 27, 16, 85, 85, 17, 20, 20, 52, 51, 66, 60, 23),
//        intArrayOf(17, 27, 9, 80, 11, 22, 16, 89, 24, 76, 50, 87, 29, 90, 89, 59, 37, 100, 89, 11, 39, 60, 65, 12, 55, 8, 61, 24, 62),
//        intArrayOf(81, 5, 82, 1, 96, 30, 46, 2, 99, 60, 99, 7, 88, 53, 26, 17, 60, 7, 71, 38, 81, 44, 41, 42, 87, 11, 72, 37, 38),
//        intArrayOf(33, 99, 61, 79, 9, 43, 10, 82, 29, 64, 57, 90, 46, 12, 76, 65, 48, 20, 85, 85, 28, 6, 58, 11, 59, 57, 55, 89, 62),
//        intArrayOf(98, 1, 77, 47, 44, 5, 67, 2, 11, 19, 73, 20, 7, 11, 98, 22, 79, 23, 18, 93, 50, 75, 48, 83, 42, 86, 45, 26, 70),
//        intArrayOf(61, 38, 59, 6, 30, 79, 5, 60, 89, 63, 58, 10, 54, 37, 87, 3, 4, 27, 30, 86, 39, 39, 58, 94, 83, 72, 56, 82, 91),
//        intArrayOf(19, 61, 52, 39, 34, 77, 7, 12, 80, 2, 4, 32, 60, 74, 7, 7, 35, 47, 49, 14, 43, 39, 80, 78, 20, 47, 45, 52, 84),
//        intArrayOf(85, 90, 47, 76, 76, 65, 10, 81, 73, 48, 17, 33, 62, 23, 84, 96, 79, 53, 72, 51, 34, 65, 27, 61, 16, 20, 53, 87, 41),
//        intArrayOf(73, 96, 14, 76, 46, 79, 8, 83, 28, 18, 84, 69, 71, 4, 58, 88, 27, 57, 70, 72, 52, 1, 54, 17, 64, 20, 59, 15, 57),
//        intArrayOf(48, 71, 64, 1, 40, 9, 59, 31, 41, 30, 14, 97, 29, 77, 54, 7, 46, 17, 50, 77, 85, 64, 79, 62, 96, 80, 30, 49, 80),
//        intArrayOf(12, 90, 29, 68, 93, 81, 8, 96, 77, 52, 30, 9, 77, 76, 81, 61, 68, 13, 85, 91, 19, 88, 5, 4, 4, 37, 6, 15, 41),
//        intArrayOf(44, 40, 42, 55, 42, 90, 98, 82, 15, 60, 55, 57, 65, 68, 9, 20, 22, 69, 32, 16, 75, 72, 38, 48, 43, 48, 66, 39, 7),
//        intArrayOf(23, 12, 57, 47, 15, 51, 71, 79, 60, 100, 13, 90, 62, 9, 10, 17, 65, 63, 20, 54, 99, 36, 28, 99, 36, 42, 13, 15, 24),
//        intArrayOf(63, 45, 4, 34, 97, 19, 60, 90, 54, 100, 9, 3, 31, 74, 100, 39, 94, 35, 84, 17, 63, 92, 46, 38, 51, 89, 72, 34, 45),
//        intArrayOf(27, 41, 17, 94, 59, 58, 40, 20, 68, 73, 11, 12, 79, 54, 24, 81, 54, 5, 39, 63, 17, 71, 8, 72, 5, 96, 92, 57, 2),
//        intArrayOf(39, 27, 29, 9, 8, 96, 42, 30, 100, 38, 84, 7, 12, 79, 41, 2, 96, 98, 46, 60, 49, 63, 82, 93, 13, 37, 41, 4, 1),
//        intArrayOf(45, 96, 72, 56, 17, 99, 13, 76, 55, 82, 4, 70, 69, 81, 31, 18, 100, 75, 5, 36, 20, 14, 54, 100, 16, 47, 43, 90, 76),
//        intArrayOf(68, 53, 55, 15, 41, 99, 68, 11, 84, 77, 41, 83, 19, 27, 53, 84, 52, 92, 68, 52, 55, 83, 87, 81, 87, 22, 26, 90, 32),
//        intArrayOf(11, 80, 55, 60, 7, 76, 44, 5, 3, 13, 8, 68, 4, 14, 50, 39, 75, 36, 41, 73, 74, 10, 91, 44, 22, 93, 68, 23, 58),
//        intArrayOf(81, 65, 59, 46, 25, 67, 40, 12, 54, 4, 62, 77, 47, 16, 49, 62, 25, 28, 98, 13, 94, 25, 70, 11, 23, 64, 66, 62, 65),
//        intArrayOf(90, 1, 85, 31, 41, 93, 72, 35, 99, 67, 19, 31, 32, 100, 58, 5, 83, 10, 13, 59, 31, 26, 71, 100, 92, 46, 14, 7, 65),
//        intArrayOf(68, 86, 50, 31, 13, 94, 93, 87, 63, 79, 5, 93, 84, 38, 94, 95, 100, 25, 68, 71, 33, 65, 9, 81, 61, 54, 57, 38, 54),
//        intArrayOf(31, 95, 4, 14, 30, 20, 23, 84, 3, 6, 25, 5, 43, 63, 22, 95, 4, 6, 71, 34, 29, 77, 34, 23, 48, 57, 2, 8, 69),
//        intArrayOf(62, 94, 72, 32, 92, 6, 94, 19, 88, 48, 15, 56, 24, 34, 38, 66, 43, 5, 59, 76, 54, 60, 97, 36, 53, 39, 63, 20, 84),
//        intArrayOf(31, 19, 83, 85, 46, 20, 19, 35, 30, 67, 30, 49, 66, 43, 29, 34, 73, 52, 48, 80, 31, 16, 54, 23, 21, 52, 6, 57, 99),
//        intArrayOf(98, 90, 97, 66, 6, 2, 83, 78, 97, 57, 83, 22, 22, 78, 47, 61, 44, 79, 4, 42, 36, 79, 36, 24, 36, 30, 97, 31, 12),
//        intArrayOf(88, 63, 41, 35, 72, 87, 29, 68, 77, 32, 45, 37, 31, 27, 88, 68, 31, 63, 23, 41, 99, 45, 59, 16, 55, 42, 17, 91, 59),
//        intArrayOf(85, 69, 38, 50, 63, 90, 77, 67, 14, 57, 54, 34, 87, 65, 100, 37, 30, 84, 53, 42, 33, 43, 52, 17, 13, 60, 31, 22, 72),
//        intArrayOf(66, 55, 51, 70, 29, 69, 23, 96, 87, 72, 56, 5, 19, 41, 32, 66, 39, 80, 82, 90, 49, 94, 13, 86, 42, 54, 6, 19, 33),
//        intArrayOf(27, 44, 43, 80, 26, 95, 85, 53, 71, 77, 1, 21, 100, 38, 94, 61, 48, 42, 62, 95, 41, 24, 24, 44, 49, 83, 15, 24, 79),
//        intArrayOf(25, 81, 71, 76, 100, 29, 75, 77, 6, 11, 93, 14, 22, 93, 1, 72, 74, 73, 67, 61, 50, 75, 61, 81, 26, 84, 31, 4, 38),
//        intArrayOf(61, 45, 25, 82, 88, 49, 21, 94, 20, 60, 25, 95, 5, 93, 77, 29, 71, 36, 63, 69, 76, 53, 100, 93, 69, 53, 15, 45, 94),
//        intArrayOf(68, 83, 50, 33, 21, 7, 30, 93, 28, 51, 5, 80, 44, 36, 64, 49, 5, 69, 85, 40, 53, 65, 73, 85, 86, 94, 8, 64, 4),
//        intArrayOf(87, 36, 12, 31, 94, 34, 50, 52, 16, 73, 38, 89, 90, 54, 58, 64, 43, 30, 22, 19, 84, 59, 71, 35, 68, 8, 57, 20, 93),
//        intArrayOf(20, 37, 99, 6, 88, 16, 65, 89, 42, 1, 69, 15, 15, 91, 79, 21, 92, 97, 49, 95, 68, 7, 24, 80, 9, 72, 84, 63, 24),
//        intArrayOf(89, 67, 1, 40, 64, 50, 8, 82, 21, 51, 53, 68, 42, 15, 58, 18, 18, 97, 33, 25, 90, 95, 35, 86, 9, 97, 73, 3, 98),
//        intArrayOf(7, 77, 70, 92, 88, 33, 2, 73, 92, 41, 73, 11, 11, 20, 90, 7, 43, 29, 96, 76, 93, 88, 54, 50, 76, 94, 16, 8, 8),
//        intArrayOf(74, 68, 74, 34, 18, 1, 99, 6, 96, 16, 33, 98, 75, 5, 8, 26, 11, 29, 52, 42, 11, 29, 34, 2, 16, 40, 5, 76, 17),
//        intArrayOf(42, 36, 59, 32, 65, 53, 53, 66, 6, 98, 54, 100, 45, 61, 26, 40, 36, 53, 83, 99, 35, 18, 90, 77, 100, 14, 92, 40, 3),
//        intArrayOf(18, 46, 9, 40, 75, 44, 14, 87, 88, 75, 69, 57, 88, 33, 91, 18, 58, 90, 87, 2, 24, 52, 97, 1, 24, 27, 10, 64, 60),
//        intArrayOf(49, 17, 37, 43, 86, 12, 52, 81, 32, 8, 87, 41, 19, 78, 89, 60, 12, 7, 54, 67, 51, 72, 100, 69, 81, 73, 1, 83, 57),
//        intArrayOf(42, 39, 36, 76, 11, 50, 85, 49, 1, 81, 36, 80, 47, 24, 11, 31, 99, 3, 1, 38, 59, 20, 60, 40, 70, 97, 72, 17, 88)
//    )
//    val B = intArrayOf(33)
//    val C = intArrayOf(1)
//    val D = intArrayOf(37)
//    val E = intArrayOf(9)
//    val ans = solveSubMatrix(A,B,C,D,E)
    val aaa = solveSubMatrixSum(arrayOf(
        intArrayOf(8, 9, 9, 1, 7),
        intArrayOf(5, 5, 10, 1, 0),
        intArrayOf(7, 7, 5, 8, 6),
        intArrayOf(7, 3, 7, 9, 2),
        intArrayOf(7, 7, 8, 10, 6)
    ))
    val g = 0
}

fun solveSubMatrixSum(A: Array<IntArray>): Int{
    val psum = Array(A.size){LongArray(A[0].size)}
    //convert all rows to prefix sum
    for(i in A.indices){
        for(j in A[i].indices){
            if(j != 0)
                psum[i][j] = psum[i][j-1] + A[i][j]
            else
                psum[i][j] = A[i][j].toLong()
        }
    }
    //convert all columns to prefix sum
    val l = A.maxOf{it.size}
    for(i in 0 until l)
        for(j in 0 until A.size)
            if(j != 0)
                psum[j][i] = psum[j-1][i] + psum[j][i]

    return psum.sumOf { it.sum() }.toInt()
}
fun solveSubMatrix(A: Array<IntArray>, B: IntArray, C: IntArray, D: IntArray, E: IntArray): IntArray {
    if(A.isEmpty())
        return intArrayOf(0)

    val psum = Array(A.size){LongArray(A[0].size)}
    //convert all rows to prefix sum
    for(i in A.indices){
        for(j in A[i].indices){
            if(j != 0)
                psum[i][j] = psum[i][j-1] + A[i][j]
            else
                psum[i][j] = A[i][j].toLong()
        }
    }
    //convert all columns to prefix sum
    val l = A.maxOf{it.size}
    for(i in 0 until l)
        for(j in 0 until A.size)
            if(j != 0)
                psum[j][i] = psum[j-1][i] + psum[j][i]

    val ans = IntArray(B.size)
    //for each query in BCDE
    for(i in B.indices){
        val b = B[i]
        val c = C[i]
        val d = D[i]
        val e = E[i]

        val mod=1000000007

        if(b == 1 && c > 1){
            //zero row
            ans[i] = (((psum[d-1][e-1] - psum[d-1][c-2])%mod+mod)%mod).toInt()
        }
        else if(b > 1 && c == 1){
            //zero column
            ans[i] = (((psum[d-1][e-1] - psum[b-2][e-1])%mod+mod)%mod).toInt()
        }
        else if (b+c == 2){
            //0,0
            ans[i] = (((psum[d-1][e-1])%mod+mod)%mod).toInt()
        }
        else {
            ans[i] = (((psum[d-1][e-1] - psum[d-1][c-2] - psum[b-2][e-1] + psum[b-2][c-2])%mod+mod)%mod).toInt()
        }
    }
    return ans
}

